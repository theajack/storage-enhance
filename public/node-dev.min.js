!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.StorageEnhance=e():t.StorageEnhance=e()}(this,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";n.d(e,"g",(function(){return o})),n.d(e,"e",(function(){return a})),n.d(e,"f",(function(){return i})),n.d(e,"c",(function(){return u})),n.d(e,"a",(function(){return c})),n.d(e,"d",(function(){return f})),n.d(e,"b",(function(){return p})),n.d(e,"h",(function(){return s}));var r=n(1),o="object"==typeof window&&!!window&&!i(window.localStorage),a="object"==typeof wx&&!!wx;function i(t){return void 0===t}function u(t){if(null===t||"object"!=typeof t)return t;var e=Array.isArray(t)?[]:{};for(var n in t)t.hasOwnProperty(n)&&(e[n]=u(t[n]));return e}function c(t){var e=t.key,n=t.path;return n&&"/"!==n||(n=""),n+"/"+encodeURIComponent(e)}function f(t){return t.map((function(t){return function(t){return t.substring(t.lastIndexOf("/")+1)}(t)}))}function p(t){return Date.now()+t}function s(t){if(null===t||"symbol"==typeof t)return r.a;var e=function(t){try{return JSON.parse(t)}catch(t){return null}}(t);return null===e?t:e}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=Symbol("storage-empty")},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(0),o=r.g?"web":r.e?"miniapp":"node"},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return s}));var r=n(2),o=n(1),a=n(0),i={},u={};"node"===r.a&&(i=n(5),u=n(6));var c="/storage-enhance-data",f=t.env.HOME||t.env.USERPROFILE||"/";if("node"===r.a){var p=u.resolve(f,"."+c);i.existsSync(p)||i.mkdirSync(p)}var s={name:"node",length:function(t){var e=(void 0===t?{}:t).path;return this.keys({path:e}).length},keys:function(t){return l("",h({key:"",path:(void 0===t?{}:t).path}),[])},exist:function(t){var e=h({key:t.key,path:t.path});return i.existsSync(e)},get:function(t){var e=v({key:t.key,path:t.path});return Object(a.h)(e)},set:function(t){var e=t.key,n=t.value,r=h({key:e,path:t.path});return console.log(r),i.writeFileSync(r,JSON.stringify(n)),!0},remove:function(t){var e=h({key:t.key,path:t.path});if(i.existsSync(e))try{return i.rmSync(d(e)),!0}catch(t){return!1}return!1},all:function(t){for(var e=(void 0===t?{}:t).path,n=this.keys({path:e}),r={},o=0,i=n.length;o<i;o++){var u=n[o];r[u]=Object(a.h)(v({key:u,check:!1,filePath:y(u,e)}))}return r},clear:function(t){var e=h({key:"",path:(void 0===t?{}:t).path});if(i.existsSync(e))try{return console.log(e),function t(e){for(var n=i.readdirSync(e),r=0,o=n.length;r<o;r++){var a=n[r],u=a.lastIndexOf(".json"),c=e+"/"+a;-1!==u?i.rmSync(d(c)):(t(c),i.rmdirSync(d(c)))}}(e),!0}catch(t){return console.log(t),!1}return console.log(e),!1}};function y(t,e){return void 0===e&&(e=""),u.resolve(f,"."+c+e+t+".json")}function v(t){var e=t.key,n=t.path,r=t.check,a=void 0===r||r,u=t.filePath;return u=u||h({key:e,path:n}),!a||i.existsSync(u)?i.readFileSync(u,"utf-8"):o.a}function l(t,e,n){for(var r=i.readdirSync(e),o=0,a=r.length;o<a;o++){var c=r[o],f=c.lastIndexOf(".json");-1!==f?n.push(t+"/"+c.substring(0,f)):l(t+"/"+c,u.resolve(e,c),n)}return n}function h(t){var e=t.key,n=t.path,r=void 0===n?"":n;if(r)for(var o=r.split("/"),a="",p=0;p<o.length;p++)if(o[p]){a+="/"+o[p];var s=u.resolve(f,"."+c+a);i.existsSync(s)||i.mkdirSync(s)}return e&&(e="/"+e+".json"),u.resolve(f,"."+c+r+e)}function d(t){if(-1===t.indexOf(c))throw new Error("Invaild Removed FilePath:"+t);return t}}).call(this,n(4))},function(t,e){var n,r,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function u(t){if(n===setTimeout)return setTimeout(t,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(t){n=a}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(t){r=i}}();var c,f=[],p=!1,s=-1;function y(){p&&c&&(p=!1,c.length?f=c.concat(f):s=-1,f.length&&v())}function v(){if(!p){var t=u(y);p=!0;for(var e=f.length;e;){for(c=f,f=[];++s<e;)c&&c[s].run();s=-1,e=f.length}c=null,p=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function l(t,e){this.fun=t,this.array=e}function h(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];f.push(new l(t,e)),1!==f.length||p||u(v)},l.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("path")},function(t,e,n){"use strict";n.r(e);var r=n(0),o={name:"miniapp",length:function(t){var e=(void 0===t?{}:t).path;return this.keys({path:e}).length},keys:function(t){var e=(void 0===t?{}:t).path,n=wx.getStorageInfoSync().keys;return e?Object(r.d)(n.filter((function(t){return 0===t.indexOf(e)}))):Object(r.d)(n)},get:function(t){var e=t.key,n=t.path;return e=Object(r.a)({key:e,path:n}),wx.getStorageSync(e)},set:function(t){var e=t.key,n=t.value,o=t.path;try{return e=Object(r.a)({key:e,path:o}),wx.setStorageSync(e,n),!0}catch(t){return!1}},remove:function(t){var e=t.key,n=t.path;try{return e=Object(r.a)({key:e,path:n}),wx.removeStorageSync(e),!0}catch(t){return!1}},clear:function(t){var e=(void 0===t?{}:t).path;try{if(e)for(var n=this.keys({path:e}),r=0,o=n.length;r<o;r++)this.remove({key:n[r]});else wx.clearStorageSync();return!0}catch(t){return!1}},all:function(t){for(var e=(void 0===t?{}:t).path,n={},r=this.keys({path:e}),o=0,a=r.length;o<a;o++){var i=r[o];n[i]=this.get({key:i})}return n},exist:function(t){var e=t.key,n=t.path;return-1!==this.keys({path:n}).indexOf(e)}},a=n(2),i="local";function u(){return i}var c={date:Date,reg:RegExp};function f(t){var e=typeof t;if("object"===e){var n=function(t){if(!t)return"null";for(var e in c){var n=e,o=c[n];if(!Object(r.f)(o)&&t instanceof o)return n}return""}(t);if(n)return n}return e}function p(t){var e=t.type,n=t.path,o=Object.keys(y(e));if(!n)return{originKeys:o,keys:Object(r.d)(o)};"/"!==n[n.length-1]&&(n+="/");var a=o.filter((function(t){return 0===t.indexOf(n)}));return{originKeys:a,keys:Object(r.d)(a)}}"web"===a.a&&(c.html=HTMLElement);var s={name:"web",length:function(t){var e=void 0===t?{}:t,n=e.type,r=e.path,o=y(n);return r?Object.keys(o).filter((function(t){return 0===t.indexOf(r)})).length:o.length},keys:function(t){var e=void 0===t?{}:t;return p({type:e.type,path:e.path}).keys},get:function(t){var e=t.key,n=t.type,o=t.path;e=Object(r.a)({key:e,path:o});var a=y(n).getItem(e);return Object(r.h)(a)},set:function(t){var e=t.key,n=t.value,o=t.type,a=t.path;try{return e=Object(r.a)({key:e,path:a}),y(o).setItem(e,JSON.stringify(n)),!0}catch(t){return!1}},remove:function(t){var e=t.key,n=t.type,o=t.path;try{return e=Object(r.a)({key:e,path:o}),y(n).removeItem(e),!0}catch(t){return!1}},clear:function(t){var e=void 0===t?{}:t,n=e.type,r=e.path;try{if(r)for(var o=this.keys({path:r,type:n}),a=0,i=o.length;a<i;a++)this.remove({key:o[a],type:n});else y(n).clear();return!0}catch(t){return!1}},all:function(t){for(var e=void 0===t?{}:t,n=e.type,o={},a=p({type:n,path:e.path}),i=a.originKeys,u=a.keys,c=y(n),f=0,s=u.length;f<s;f++){var v=u[f],l=c.getItem(i[f]);o[v]=Object(r.h)(l)}return o},exist:function(t){var e=t.key,n=t.type,o=t.path;return e=Object(r.a)({key:e,path:o}),y(n).hasOwnProperty(e)}};function y(t){return void 0===t&&(t=u()),"local"===t?window.localStorage:window.sessionStorage}var v=n(3),l={function:{set:function(t){return"return ("+t.toString()+");"},get:function(t){return new Function(t)()}},reg:{set:function(t){return t.toString()},get:function(t){return new RegExp(t)}},html:{set:function(t){return t.outerHTML},get:function(t){var e=document.createElement("div");return e.innerHTML=t,e.children[0]}},date:{set:function(t){return t.getTime()},get:function(t){return new Date(t)}},symbol:{set:function(t){return t.toString()},get:function(t){return t.toString()}}};function h(t){var e=t.type,n=t.data,r=t.oprate,o=l[e];return o?o[r](n):n}var d={};function g(t,e){if(void 0===t&&(t=""),void 0===e&&(e="get"),!t||"/"===t){if("get"===e||"set"===e)return d;if("clear"===e)return d={},!0}for(var n=t.split("/"),r=d,o=0,a=n.length;o<a;o++){var i=n[o];if(i){if(!r[i])if("set"===e)r[i]={};else{if("get"===e)return r;if("clear"===e)return!1}if("clear"===e&&o===a-1)return delete r[i],!0;r=r[i]}}return r}var m={name:"temp",length:function(t){var e=(void 0===t?{}:t).path;return this.keys({path:e}).length},keys:function(t){var e=(void 0===t?{}:t).path;return Object.keys(g(e))},exist:function(t){var e=t.key;return g(t.path).hasOwnProperty(e)},get:function(t){var e=t.key,n=t.path;return this.exist({key:e})?Object(r.c)(g(n)[e]):null},set:function(t){var e=t.key,n=t.value;return g(t.path,"set")[e]=Object(r.c)(n),!0},remove:function(t){var e=t.key;return delete g(t.path)[e],!0},all:function(t){var e=(void 0===t?{}:t).path;return Object(r.c)(g(e))},clear:function(t){return g((void 0===t?{}:t).path,"clear")}},k=n(1),b=[];var x={name:"times",get:function(t){var e=t.options,n=t.data,r=t.storage;if("number"!=typeof n.times)return n;if(n.times<=1){if(r.remove(e),n.times<1)return k.a}else n.times-=1,r.set({key:e.key,value:n,type:e.type,path:e.path});return n},set:function(t){var e=t.options,n=t.data;e.once&&(e.times=1);var r=e.times;if("number"==typeof r){if(0===r)return!1;n.times=r}return n}};function O(t){var e=t.key,n=t.value,r=t.expires,o=t.path,a=t.domain,i=t.secure,u=t.sameSite,c=t.sameParty,f=t.priority,p=e+"="+escape(n)+";";r&&(p+="expires="+("number"==typeof r?new Date(r):r).toUTCString()+";");o&&(p+="path="+o+";"),a&&(p+="domain="+a+";"),i&&(p+="secure;"),u&&("None"!==u||i?p+="sameSite="+u+";":console.warn("设置sameSite=None时必须设置secure=true")),c&&(i?p+="sameParty;":console.warn("设置sameParty=true时必须设置secure=true")),f&&(p+="priority="+f+";");try{return document.cookie=p,!0}catch(t){return console.warn(t),!1}}var w={get:function(t){var e=t.key,n=document.cookie,r=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),o=n.match(r);return o?unescape(o[2]):k.a},set:O,remove:function(t){var e=t;return e.expires=Object(r.b)(-1e3),O(e)},checkPath:function(t){return void 0===t&&(t=""),!t||(console.warn("Cookie 操作无效: path与当前pathname不一致; "+t+" - "+location.pathname),t===location.pathname)}},S=function(){return(S=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},j={name:"cookie",length:function(t){var e=(void 0===t?{}:t).path;return w.checkPath(e)?document.cookie.split(";").length:0},keys:function(t){var e=(void 0===t?{}:t).path;return w.checkPath(e)?document.cookie.split(";").map((function(t){return t.split("=")[0].trim()})):[]},get:function(t){var e=t.key,n=t.path;if(!w.checkPath(n))return k.a;var o=w.get({key:e});return Object(r.h)(o)},set:function(t){var e=t.key,n=t.value,r=t.path,o=t.cookie;try{return w.set(S({key:e,value:JSON.stringify(n),path:r},o)),!0}catch(t){return!1}},remove:function(t){var e=t.key,n=t.path,r=t.domain;return w.remove({key:e,path:n,domain:r})},clear:function(t){for(var e=void 0===t?{}:t,n=e.path,r=e.domain,o=this.keys(),a=0,i=o.length;a<i;a++)this.remove({key:o[a],path:n,domain:r});return!0},all:function(t){var e=(void 0===t?{}:t).path,n={};return w.checkPath(e)?(document.cookie.split(";").forEach((function(t){var e=t.split("=");n[e[0].trim()]=Object(r.h)(e[1])})),n):n},exist:function(t){var e=t.key;return-1!==this.keys().indexOf(e)}};function T(t){return t<Date.now()}var P={name:"expires",get:function(t){var e=t.options,n=t.data,r=t.storage;return"cookie"===r.name||"number"!=typeof n.expires?n:T(n.expires)?(r.remove(e),k.a):n},set:function(t){var e=t.options,n=t.data;if("cookie"===t.storage.name)return"number"==typeof e.expires&&("object"==typeof e.cookie?e.cookie.expires=e.expires:e.cookie={expires:e.expires}),n;if("number"==typeof e.expires){if(T(e.expires))return!1;n.expires=e.expires}return n}},D={};function E(){return D}function F(t){return"string"==typeof t?"@:"+t:h({data:t,type:"function",oprate:"set"})}var I={name:"event",get:function(t){var e=t.data,n=t.onFinalData;return e.onGet?(n((function(t){L(e.onGet,t)})),e):e},set:function(t){var e=t.options,n=t.data,r=t.prevData;return e.onGet&&(n.onGet=F(e.onGet)),"object"==typeof r&&L(r.onSet,n.value),e.onSet&&(n.onSet=F(e.onSet),L(n.onSet,n.value)),n},remove:function(t){var e=t.prevData;return"object"==typeof e&&L(e.onRemove,e.value),!0}};function L(t,e){if(void 0!==t){var n=function(t){if(0===t.indexOf("@:")){var e=t.substring(2),n=E();return"function"==typeof n[e]?n[e]:null}return new Function(t)()}(t);null!==n?n({scope:E(),data:e}):console.warn("Invalid event:",t)}}var M={name:"final",set:function(t){var e=t.options,n=t.data,r=t.prevData;return"object"==typeof r&&!0===r.final?(console.warn("Final 类型禁止设置新的值："+e.key),!1):("boolean"==typeof e.final&&(n.final=e.final),n)}},R={web:s,miniapp:o,node:v.a}[a.a];function A(t){return void 0===t&&(t=u()),"web"===a.a&&"cookie"===t?j:"temp"===t||"web"!==a.a&&"local"!==t?m:R}var N={EMPTY:k.a,use:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];b.push.apply(b,t)},plugins:function(){return b},registScope:function(t,e){"string"==typeof t?D[t]=e:Object.assign(D,t)},scope:E,env:a.a,type:function(t){if(!t)return u();!function(t){i=t}(t)},length:function(t){var e=void 0===t?{}:t,n=e.type,r=e.path;return A(n).length({type:n,path:r})},clear:function(t){void 0===t&&(t={});var e=t.type,n=t.path,r=t.domain,o=A(e),a=this.keys(t),i={};for(var u in a){var c=G({getOption:{key:u,type:e,path:n},storage:o,removeOption:{key:u,domain:r}}),f=c.result,p=c.prevData;!1===f&&"object"==typeof p&&(i[u]=p)}var s=o.clear({type:e,path:n,domain:r});for(var u in i)this.set({key:u,value:i[u].value,type:e,path:n});return s},keys:function(t){var e=void 0===t?{}:t,n=e.type,r=e.path;return A(n).keys({type:n,path:r})},remove:function(t){var e=t.key,n=t.type,r=t.path,o=t.domain;if(""===e)return!0;var a=A(n);return!1!==G({getOption:{key:e,type:n,path:r},storage:a,removeOption:t}).result&&a.remove({key:e,type:n,path:r,domain:o})},exist:function(t){var e=t.key,n=t.type,r=t.path;return""!==e&&A(n).exist({key:e,type:n,path:r})},set:function(t,e){if(t instanceof Array){var n=!0;for(var r in t)this.set(t[r])||(n=!1);return n}var o="object"==typeof t?t:{key:t,value:e},a=o.key,i=o.value,u=o.type,c=o.path;if(""===a)return!1;var p=function(t){var e=t.data,n=t.storageType,r=void 0===n?"local":n,o=f(e);return{type:o,value:"temp"===r?e:h({type:o,data:e,oprate:"set"})}}({data:i,storageType:u}),s=A(u),y=s.get({key:a,type:u,path:c}),v=function(t){for(var e=0;e<b.length;e++){var n=b[e];if("function"==typeof n.set){var r=n.set(t);if("boolean"==typeof r)return r;t.data=r}}return t.data}({options:o,data:p,storage:s,prevData:y});return"boolean"==typeof v?v:(o.value=v,console.log("executePluginsSet result",p),s.set(o))},get:function(t){if(t instanceof Array){var e=[];for(var n in t)e.push(this.get(t[n]));return e}var r="object"==typeof t?t:{key:t},o=r.key,a=r.type,i=r.path;if(""===o)return k.a;var u=A(a);return _({options:r,data:u.get({key:o,type:a,path:i}),storage:u})},all:function(t){var e=void 0===t?{}:t,n=e.type,r=e.path,o=A(n),a=o.all({type:n,path:r});for(var i in a)if("object"==typeof a[i]){var u=a[i];a[i]=_({options:{key:i,type:n,path:r},data:u,storage:o})}return a}};function _(t){var e=t.options,n=t.data,r=t.storage;if("string"==typeof n||"symbol"==typeof n)return n;var o,a=(o=null,{onFinalData:function(t){o=t},trigFinalData:function(t){"function"==typeof o&&o(t)}}),i=a.trigFinalData;if("symbol"==typeof(n=function(t){for(var e=0;e<b.length;e++){var n=b[e];if("function"==typeof n.get){var r=n.get(t);if("symbol"==typeof r)return k.a;t.data=r}}return t.data}({options:e,data:n,storage:r,onFinalData:a.onFinalData})))return k.a;var u=function(t){var e=t.data,n=t.storageType;return"temp"===(void 0===n?"local":n)?e.value:h({type:e.type,data:e.value,oprate:"get"})}({storageType:e.type,data:n});return i(u),u}function G(t){var e=t.getOption,n=t.storage,r=t.removeOption,o=n.get(e);return{result:function(t){for(var e=0;e<b.length;e++){var n=b[e];if("function"==typeof n.remove)if(!1===n.remove(t))return!1}return!0}({options:r,storage:n,prevData:o}),prevData:o}}N.use(M,{name:"protect",set:function(t){var e=t.options,n=t.data;return"boolean"==typeof e.protect&&(n.protect=e.protect),n},remove:function(t){var e=t.prevData;return"object"!=typeof e||!0!==e.protect}},x,P,I);e.default=N}]).default}));